{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Kill Port 8000",
            "type": "shell",
            "command": "lsof -ti:8000 | xargs kill -9",
            "windows": {
                "command": "for /f \"tokens=5\" %a in ('netstat -aon ^| findstr :8000') do taskkill /F /PID %a"
            },
            "linux": {
                "command": "fuser -k 8000/tcp || true"
            },
            "osx": {
                "command": "lsof -ti:8000 | xargs kill -9 || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Kill Port 3000",
            "type": "shell",
            "command": "lsof -ti:3000 | xargs kill -9",
            "windows": {
                "command": "for /f \"tokens=5\" %a in ('netstat -aon ^| findstr :3000') do taskkill /F /PID %a & timeout /t 5 /nobreak >nul"
            },
            "linux": {
                "command": "fuser -k 3000/tcp || true"
            },
            "osx": {
                "command": "lsof -ti:3000 | xargs kill -9 || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Kill Port 5173",
            "type": "shell",
            "command": "lsof -ti:5173 | xargs kill -9",
            "windows": {
                "command": "for /f \"tokens=5\" %a in ('netstat -aon ^| findstr :5173') do taskkill /F /PID %a"
            },
            "linux": {
                "command": "fuser -k 5173/tcp || true"
            },
            "osx": {
                "command": "lsof -ti:5173 | xargs kill -9 || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Ensure Postgres Running",
            "type": "shell",
            "command": "./scripts/ensure-postgres.sh",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Kill Chrome Debug Sessions",
            "type": "shell",
            "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true",
            "windows": {
                "command": "taskkill /F /IM chrome.exe /FI \"COMMANDLINE eq *remote-debugging-pipe*\" 2>nul || taskkill /F /IM chrome.exe /FI \"COMMANDLINE eq *ms-vscode.js-debug*\" 2>nul || exit 0"
            },
            "linux": {
                "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true"
            },
            "osx": {
                "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Prepare FastAPI Backend",
            "dependsOn": [
                // "Ensure Postgres Running", // using Neon locally now too. 
                "Kill Port 8000"
            ],
            "dependsOrder": "sequence",
            "problemMatcher": []
        },
        {
            "label": "Prepare Next.js Frontend",
            "dependsOn": [
                "Kill Chrome Debug Sessions",
                "Kill Port 3000"
            ],
            "dependsOrder": "sequence",
            "problemMatcher": []
        },
        {
            "label": "Prepare React Router Frontend",
            "dependsOn": [
                "Kill Chrome Debug Sessions",
                "Kill Port 5173"
            ],
            "dependsOrder": "sequence",
            "problemMatcher": []
        }
    ]
}

