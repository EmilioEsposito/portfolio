{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Kill FastAPI Port",
            "type": "shell",
            "command": "PORT=$(grep -E '^PORT=' .env 2>/dev/null | cut -d= -f2); PORT=${PORT:-8000}; echo \"Killing FastAPI port $PORT\"; lsof -ti:$PORT | xargs kill -9 || true",
            "windows": {
                "command": "for /f \"tokens=2 delims==\" %p in ('findstr /B \"PORT=\" .env') do (echo Killing port %p & for /f \"tokens=5\" %a in ('netstat -aon ^| findstr :%p') do taskkill /F /PID %a) || exit 0"
            },
            "linux": {
                "command": "PORT=$(grep -E '^PORT=' .env 2>/dev/null | cut -d= -f2); PORT=${PORT:-8000}; echo \"Killing FastAPI port $PORT\"; fuser -k $PORT/tcp || true"
            },
            "osx": {
                "command": "PORT=$(grep -E '^PORT=' .env 2>/dev/null | cut -d= -f2); PORT=${PORT:-8000}; echo \"Killing FastAPI port $PORT\"; lsof -ti:$PORT | xargs kill -9 || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Kill Frontend Port",
            "type": "shell",
            "command": "PORT=$(grep -E '^VITE_PORT=' apps/web-react-router/.env 2>/dev/null | cut -d= -f2); PORT=${PORT:-5173}; echo \"Killing frontend port $PORT\"; lsof -ti:$PORT | xargs kill -9 || true",
            "windows": {
                "command": "for /f \"tokens=2 delims==\" %p in ('findstr /B \"VITE_PORT=\" apps\\web-react-router\\.env') do (echo Killing port %p & for /f \"tokens=5\" %a in ('netstat -aon ^| findstr :%p') do taskkill /F /PID %a) || exit 0"
            },
            "linux": {
                "command": "PORT=$(grep -E '^VITE_PORT=' apps/web-react-router/.env 2>/dev/null | cut -d= -f2); PORT=${PORT:-5173}; echo \"Killing frontend port $PORT\"; fuser -k $PORT/tcp || true"
            },
            "osx": {
                "command": "PORT=$(grep -E '^VITE_PORT=' apps/web-react-router/.env 2>/dev/null | cut -d= -f2); PORT=${PORT:-5173}; echo \"Killing frontend port $PORT\"; lsof -ti:$PORT | xargs kill -9 || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Ensure Postgres Running",
            "type": "shell",
            "command": "./scripts/ensure-postgres.sh",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            }
        },
        {
            "label": "Kill Chrome Debug Sessions",
            "type": "shell",
            "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true",
            "windows": {
                "command": "taskkill /F /IM chrome.exe /FI \"COMMANDLINE eq *remote-debugging-pipe*\" 2>nul || taskkill /F /IM chrome.exe /FI \"COMMANDLINE eq *ms-vscode.js-debug*\" 2>nul || exit 0"
            },
            "linux": {
                "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true"
            },
            "osx": {
                "command": "pkill -9 -f 'remote-debugging-pipe|ms-vscode.js-debug' 2>/dev/null || true"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared"
            }
        },
        {
            "label": "Prepare FastAPI Backend",
            "dependsOn": [
                "Kill FastAPI Port"
            ],
            "dependsOrder": "sequence",
            "problemMatcher": []
        },
        {
            "label": "Prepare React Router Frontend",
            "dependsOn": [
                "Kill Chrome Debug Sessions",
                "Kill Frontend Port"
            ],
            "dependsOrder": "sequence",
            "problemMatcher": []
        }
    ]
}
